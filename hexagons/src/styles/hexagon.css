/* src/styles/hexagon.css */

/* =========================
   Layout Wrapper
========================= */
.hx-wrap {
  width: 100%;
  display: grid;
  place-items: center;

  padding: clamp(14px, 2.4vh, 28px) clamp(12px, 2.2vw, 20px);

  overflow: visible;
}

.hx-grid {
  /*
    The whole cluster scales by deriving hx-size from viewport.
    - Desktop stays near 250px
    - Laptops scale down automatically
    - Mobile scales down further but remains readable
  */
  --hx-size: clamp(135px, 18.5vmin, 250px);
  --hx-gap: clamp(4px, 0.9vmin, 10px);

  /* Flat-top hex height ≈ 0.866 * width */
  --hx-h: calc(var(--hx-size) * 0.866);

  /* Base steps */
  --hx-xstep: calc((var(--hx-size) * 0.78) + var(--hx-gap));
  --hx-ystep: calc((var(--hx-h) * 0.78) + var(--hx-gap));

  /* Rhombus shape */
  --hx-y-outer: calc(var(--hx-ystep) * 1.55);
  --hx-y-shoulder: calc(var(--hx-ystep) * 0.85);
  --hx-x-shoulder: calc(var(--hx-xstep) * 1.1);

  /*
    NEW: cluster bounds derived from your own geometry instead of multipliers.
    This prevents “too big / clipped” on laptops + mobile.
  */
  --hx-cluster-w: calc((var(--hx-x-shoulder) * 2) + var(--hx-size));
  --hx-cluster-h: calc((var(--hx-y-outer) * 2) + var(--hx-h));

  /* Type + spacing scale with the tile size */
  --hx-pad-y: clamp(12px, calc(var(--hx-size) * 0.06), 18px);
  --hx-pad-x: clamp(10px, calc(var(--hx-size) * 0.055), 16px);

  --hx-title: clamp(18px, calc(var(--hx-size) * 0.08), 20px);
  --hx-subtitle: clamp(11px, calc(var(--hx-size) * 0.055), 14px);
  --hx-score: clamp(30px, calc(var(--hx-size) * 0.176), 44px);

  --hx-risk-w: clamp(132px, calc(var(--hx-size) * 0.68), 170px);
  --hx-risk-h: clamp(8px, calc(var(--hx-size) * 0.04), 10px);

  position: relative;

  width: min(var(--hx-cluster-w), 96vw);
  height: min(var(--hx-cluster-h), 78svh);

  /* keep it centered and avoid edge clipping on small screens */
  margin-inline: auto;
}

/* Small-device tuning (polish only, no layout changes) */
@media (max-width: 560px) {
  .hx-grid {
    /* slightly smaller top cap on very narrow screens */
    --hx-size: clamp(125px, 19.5vmin, 190px);
    height: min(var(--hx-cluster-h), 72svh);
  }
}

/* =========================
   Hex Button Shell
========================= */
.hx {
  --hx-bg: radial-gradient(
      120% 120% at 20% 10%,
      rgba(255, 255, 255, 0.22),
      rgba(255, 255, 255, 0) 45%
    ),
    linear-gradient(145deg, rgba(70, 80, 255, 0.55), rgba(30, 20, 55, 0.85));

  width: var(--hx-size);
  height: var(--hx-h);
  padding: 0;
  border: 0;
  background: transparent;
  cursor: default;
  -webkit-tap-highlight-color: transparent;

  position: absolute;
  left: 50%;
  top: 50%;

  clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);

  transform: translate(-50%, -50%) translate(var(--hx-x, 0px), var(--hx-y, 0px))
    rotate(var(--hx-rot, 0deg)) scale(var(--hx-scale, 1));

  outline: none;
}

.hx--clickable {
  cursor: pointer;
}

/* =========================
   Positioning
========================= */
.hx--center {
  --hx-x: 0px;
  --hx-y: 0px;
  z-index: 2;
}

.hx--top {
  --hx-x: 0px;
  --hx-y: calc(var(--hx-y-outer) * -1);
  z-index: 1;
}

.hx--topLeft {
  --hx-x: calc(var(--hx-x-shoulder) * -1);
  --hx-y: calc(var(--hx-y-shoulder) * -0.9);
  z-index: 1;
}

.hx--topRight {
  --hx-x: var(--hx-x-shoulder);
  --hx-y: calc(var(--hx-y-shoulder) * -0.9);
  z-index: 1;
}

/* Bottom tip */
.hx--bottom {
  --hx-x: 0px;
  --hx-y: var(--hx-y-outer);
  z-index: 1;
}

/* Bottom shoulders */
.hx--bottomLeft {
  --hx-x: calc(var(--hx-x-shoulder) * -1);
  --hx-y: calc(var(--hx-y-shoulder) * 0.9);
  z-index: 1;
}

.hx--bottomRight {
  --hx-x: var(--hx-x-shoulder);
  --hx-y: calc(var(--hx-y-shoulder) * 0.9);
  z-index: 1;
}

.hx--clickable:hover,
.hx--clickable:focus-visible {
  z-index: 10;
}

/* =========================
   Flip Mechanics
========================= */
.hx__stage {
  position: absolute;
  inset: 0;
  perspective: 1000px;
  display: block;
}

.hx__flipper {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  transition: transform 0.95s cubic-bezier(0.4, 0.2, 0.2, 1);
}

.hx--clickable:hover .hx__flipper,
.hx--clickable:focus-visible .hx__flipper {
  transform: rotateY(180deg);
}

.hx__face {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  transform-style: preserve-3d;
}

.hx__face--front {
  transform: rotateY(0deg);
}

.hx__face--back {
  transform: rotateY(180deg);
}

/* =========================
   Prism Layers
========================= */
.hx__clip {
  position: absolute;
  inset: 0;
}

.hx__base {
  position: absolute;
  inset: 0;
  background: var(--hx-bg);
  background-size: cover;
  background-position: center;
}

.hx__base--back {
  filter: saturate(0.9) brightness(0.9);
}

/* SCORE OVERLAY */
.hx__overlay {
  position: absolute;
  inset: 0;
  background: rgb(var(--hx-score-rgb, 241 196 15) / var(--hx-overlay-a, 0.32));
  mask-image: radial-gradient(120% 120% at 50% 35%, #000 65%, transparent 100%);
  opacity: 1;
}

.hx__shine {
  position: absolute;
  inset: 0;
  background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.3),
      rgba(255, 255, 255, 0) 55%
    ),
    radial-gradient(
      100% 100% at 15% 15%,
      rgba(255, 255, 255, 0.25),
      rgba(255, 255, 255, 0) 60%
    );
  mix-blend-mode: screen;
  opacity: 0.65;
}

.hx__rim {
  position: absolute;
  inset: 0;
  box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.22),
    inset 0 -18px 28px rgba(0, 0, 0, 0.35), 0 18px 30px rgba(0, 0, 0, 0.28);
}

/* =========================
   Content
========================= */
.hx__content {
  position: relative;
  z-index: 1;
  height: 100%;
  padding: var(--hx-pad-y, 18px) var(--hx-pad-x, 16px);
  text-align: center;
  color: #fff;
  display: grid;
  grid-template-rows: auto auto 1fr auto auto; /* title, subtitle, spacer, score, bar/cta */
  justify-items: center;
  align-items: start;
  row-gap: clamp(6px, calc(var(--hx-size) * 0.03), 10px);
  gap: 10px;
  overflow: hidden;

  background: radial-gradient(
    85% 70% at 50% 50%,
    rgba(0, 0, 0, 0.28),
    rgba(0, 0, 0, 0.12) 55%,
    rgba(0, 0, 0, 0.02) 72%,
    transparent 100%
  );

  /* keep 3D pop */
  transform: translateZ(60px) scale(0.94);
}

.hx__title {
  font-size: var(--hx-title, 22px);
  font-weight: bold;
  line-height: 1.1;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.65), 0 10px 28px rgba(0, 0, 0, 0.45);
}

.hx__subtitle {
  font-size: var(--hx-subtitle, 14px);
  line-height: 1.25;
  opacity: 0.95;
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.55);
}

.hx__scoreBig {
  font-weight: 900;
  font-size: var(--hx-score, 44px);
  line-height: 1;
  letter-spacing: 0.5px;

  text-shadow: 0 10px 30px rgba(0, 0, 0, 0.45),
    0 0 18px rgb(var(--hx-score-rgb) / 0.45);

  color: rgb(var(--hx-score-rgb) / 0.95);
}

.hx__title,
.hx__subtitle {
  max-width: 70%;
  text-wrap: balance;
  overflow: hidden;
  overflow-wrap: break-word;
}

/* =========================
   Risk Bar (color-matched)
========================= */
.hx-risk {
  width: min(170px, 65%);
}

.hx-risk__track {
  height: 10px;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.7);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1),
    0 10px 22px rgba(0, 0, 0, 0.35);
  overflow: hidden;
}

.hx-risk__fill {
  height: 100%;
  width: 0%;
  border-radius: 999px;

  /* richer fill */
  background: linear-gradient(
    90deg,
    rgb(var(--hx-score-rgb) / 0.65),
    rgb(var(--hx-score-rgb) / 1)
  );

  /* stronger glow */
  box-shadow: 0 0 18px rgb(var(--hx-score-rgb) / 0.55),
    0 0 34px rgb(var(--hx-score-rgb) / 0.35), 0 8px 24px rgba(0, 0, 0, 0.25);

  transition: width 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* Back CTA */
.hx__cta {
  margin-top: 8px;
  display: inline-block;
  padding: 10px 14px;
  border: 2px solid rgba(255, 255, 255, 0.9);
  border-radius: 2px;
  font-weight: 800;
  letter-spacing: 0.6px;
  text-transform: uppercase;
  font-size: 13px;
  background: rgba(0, 0, 0, 0.12);
}

/* =========================
   Hover Lift (preserve offsets)
========================= */
.hx--clickable:hover,
.hx--clickable:focus-visible {
  transform: translate(-50%, -50%)
    translate(var(--hx-x, 0px), calc(var(--hx-y, 0px) - 6px))
    rotate(var(--hx-rot, 0deg)) scale(calc(var(--hx-scale, 1) * 1.02));
}

.hx--clickable:hover .hx__overlay,
.hx--clickable:focus-visible .hx__overlay {
  filter: saturate(1.25);
}
.hx--clickable:hover .hx-risk__fill,
.hx--clickable:focus-visible .hx-risk__fill {
  box-shadow: 0 0 22px rgb(var(--hx-score-rgb) / 0.65),
    0 0 44px rgb(var(--hx-score-rgb) / 0.4), 0 10px 28px rgba(0, 0, 0, 0.28);
}
/* =========================
   Legend
========================= */
.hx-legend {
  width: min(720px, 92vw);
  margin-top: 18px;
  display: grid;
  gap: 8px;
  justify-items: center;
  text-align: center;
}

.hx-legend__label {
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 0.6px;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.92);
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.45);
}

.hx-legend__barWrap {
  width: min(520px, 88%);
  display: grid;
  gap: 6px;
}

.hx-legend__bar {
  height: 12px;
  border-radius: 999px;

  /* Matches your score palette: green -> yellow -> red */
  background: linear-gradient(
    90deg,
    rgb(46 204 113 / 0.95),
    rgb(241 196 15 / 0.95),
    rgb(231 76 60 / 0.95)
  );

  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.14),
    0 10px 22px rgba(0, 0, 0, 0.35);
}

.hx-legend__ticks {
  position: relative;
  height: 16px;
  font-size: 12px;
  font-weight: 800;
  color: rgba(255, 255, 255, 0.9);
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

.hx-legend__tick {
  position: absolute;
  top: 0;
  transform: translateX(-50%);
}

.hx-legend__tick--left {
  left: 0%;
  transform: translateX(0%);
}

.hx-legend__tick--mid {
  left: 50%;
}

.hx-legend__tick--right {
  left: 100%;
  transform: translateX(-100%);
}

.hx-legend__hint {
  font-size: 12px;
  opacity: 0.92;
  color: rgba(255, 255, 255, 0.9);
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.45);
}
